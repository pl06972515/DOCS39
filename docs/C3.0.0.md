<br/>

>[!WARNING|style: flat|label: ç®€è¦è¯´æ˜ ]
>
>- <span style='color:red'>[ æµæ°´çº¿`Jenkins.Pipeline`] æ˜¯è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹çš„è„šæœ¬åŒ–æè¿°`Jenkinsfile`</span>
>
>  [ æ’ä»¶`Pipeline`] [<span style='color:#008B00'>[ğŸ‘“ æ’ä»¶åœ°å€ ]</span>](https://plugins.jenkins.io/workflow-aggregator/ ':target=_blank') [<span style='color:#008B00'>[ğŸ‘“ å®˜æ–¹æ­¥éª¤è¯´æ˜ ]</span>](https://www.jenkins.io/doc/pipeline/steps/ ':target=_blank')
>
>
>
><br/>

```shell
pipeline {
    agent any 
    
    # [ å…¨å±€: ç¯å¢ƒå˜é‡ ]
    # - ç”¨é€”ï¼šä¸ºæµæ°´çº¿ä¸­çš„æ‰€æœ‰é˜¶æ®µ ( stage + step ) æä¾›å…¨å±€æˆ–å±€éƒ¨å˜é‡ ( å¸¸ç”¨äºé…ç½®ã€å‡­æ®ã€è·¯å¾„ç­‰ )
    # - è®¾ç½®æ—¶æœºï¼šåœ¨æµæ°´çº¿è¿è¡Œå‰å°±å·²ç¡®å®š ( é€šå¸¸å†™æ­»åœ¨ Jenkinsfile é‡Œ )
    # - è®¿é—®æ–¹å¼ï¼š${env.å˜é‡å} ( åœ¨æ­¥éª¤ sh ä¸­ç›´æ¥ä½¿ç”¨ ${å˜é‡å} )
    environment {
        EN1 = 'Q1'
        EN2 = 'Q2'
    }
    
    # [ ç”¨æˆ·å‚æ•° ]
    # - ç”¨é€”ï¼šåœ¨æ‰‹åŠ¨æˆ–å®šæ—¶è§¦å‘æµæ°´çº¿æ—¶ [ å…è®¸ç”¨æˆ·è¾“å…¥æˆ–é€‰æ‹©å‚æ•°- å¦‚åˆ†æ”¯ã€ç‰ˆæœ¬å·ã€å§“åç­‰ ]
    # - è®¾ç½®æ—¶æœºï¼šåœ¨æµæ°´çº¿å¯åŠ¨æ—¶ç”±ç”¨æˆ·å¡«å†™æˆ–é€‰æ‹©
    # - è®¿é—®æ–¹å¼ï¼š${params.å‚æ•°å} ( åœ¨æ­¥éª¤ sh ä¸­æ— æ³•ç›´æ¥ä½¿ç”¨ï¼Œéœ€é€šè¿‡ç¯å¢ƒå˜é‡ )
    parameters {
        string(name:"Name", defaultValue:"SYL", description: "å§“å")
        string(name: "Age", defaultValue: "18", description: "å¹´é¾„ï¼ˆè¯·è¾“å…¥æ•°å­—ï¼‰")
    }
    
    stages {
    
        # [ é˜¶æ®µå®šä¹‰ ] "Hello" ( æ³¨æ„ï¼šåªèƒ½åŒ…å«ä¸€ä¸ª steps èŠ‚ç‚¹ )
        stage('Hello') {
            # [ å±€éƒ¨: ç¯å¢ƒå˜é‡ ] 
            environment {
                EN1 = 'Q1'
                EN2 = 'Q2'
            }
            steps {
            
                # [ é˜¶æ®µæ­¥éª¤ ]
                echo 'Hello World'
                echo "ç¯å¢ƒå˜é‡ EN1 = ${env.EN1} EN2 = ${env.EN2}"
                echo "ç”¨æˆ·å‚æ•° å§“å: ${params.Name} å¹´é¾„ = ${params.Age}"
                
                sh 'echo "ç¯å¢ƒå˜é‡ EN1 = ${EN1} EN2 = ${EN2}"'
                
                script {
                    env.Name = params.Name
                    env.Age = params.Age
                }
                sh 'echo "ç”¨æˆ·å‚æ•° å§“å: ${Name} å¹´é¾„ = ${Age}"'
                
            }
        }
        
    }
    
}


```

<!-- tabs:start -->

#### **[ ğŸŸ¢ ç®¡é“ä»»åŠ¡ ] Dockerfile**

!> <span style='color:red'>[ å»ºè®®ï¼šå…ˆé€šè¿‡æ™®é€šä»»åŠ¡æµ‹è¯•ï¼Œåœ¨é›†æˆ`Jenkinsfile`]</span> [<span style='color:#008B00'>[ğŸ‘“ Q1 ]</span>](T1.0.0 ':target=_blank')

```shell
pipeline {
    agent any 
    environment {
    
		ASPNETCORE_ENVIRONMENT = 'Production'
		ASPNETCORE_HTTP_PORTS = '7008'
		ASPNETCORE_HTTPS_PORTS = '8081'
        PUBLISH_HOST = 'http://192.168.8.144'
        
        Habor_HOST = '192.168.8.144:8087'
        Habor_LOGIN = 'admin'
        Habor_PASSWORD = '372577325'
        Habor_PUSH = 'pm2-services'
        
    }
	
    stages {
      
        stage('ã€ é˜¶æ®µï¼šGitea ã€‘ ä»£ç æ‹‰å–') {
            steps {
                git credentialsId: '9c2d1561-b171-498b-8042-2fd62719a055', url: 'http://192.168.8.144:3000/pm2-zb-services/testWebApp.git'
            }
        }
		
		stage('ã€ é˜¶æ®µï¼šDockerfile ã€‘ æ„å»ºé•œåƒ') {
            steps {
                sh 'docker build --no-cache -f ./testWebApp/Dockerfile --tag testwebapp:${BUILD_NUMBER} .'
				sh 'docker image prune -f'
            }
        }
		
		stage('ã€ é˜¶æ®µï¼šHabor ã€‘ æ¨é€é•œåƒ') {
            steps {
                sh 'docker login ${Habor_HOST} -u ${Habor_LOGIN} -p ${Habor_PASSWORD}'
				sh 'docker tag testwebapp:${BUILD_NUMBER} ${Habor_HOST}/${Habor_PUSH}/testwebapp:${BUILD_NUMBER}'
                sh 'docker push ${Habor_HOST}/${Habor_PUSH}/testwebapp:${BUILD_NUMBER}'
            }
        }
        
        /*
		stage('[ Docker ] å®¹å™¨å¯åŠ¨') {
            steps {
				sh 'docker rm -f testwebapp || true'
                sh '''
					docker run -d --name testwebapp \
					           --restart=always \
							   -p ${ASPNETCORE_HTTP_PORTS}:${ASPNETCORE_HTTP_PORTS} \
							   -e ASPNETCORE_ENVIRONMENT=${ASPNETCORE_ENVIRONMENT} \
							   -e ASPNETCORE_HTTP_PORTS=${ASPNETCORE_HTTP_PORTS} \
							   testwebapp:${BUILD_NUMBER}
				'''
            }
        }

		stage('ã€ é˜¶æ®µï¼šDocker ã€‘ å¯åŠ¨æ—¥å¿—') {
            steps {		   
				sh 'sleep 1'
				sh 'docker logs --tail 20 testwebapp'
            }
        }

        stage('ã€ é˜¶æ®µï¼šHealth ã€‘å¥åº·æ£€æŸ¥') {
            steps {
                script {
                    def result = sh(script: "curl -sf ${PUBLISH_HOST}:${ASPNETCORE_HTTP_PORTS}/health || exit 1", returnStatus: true)
                    if (result != 0) {
                        error("å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œå®¹å™¨æœªæ­£å¸¸å¯åŠ¨")
                    }
                }
            }
        }
        */
        
    }
    
}


```



#### **[ â˜¢ è„šæœ¬ç®¡ç† ] Gitea â†’ Jenkinsfile**

!> <span style='color:red'>[ é¡¹ç›®æ ¹ç›®å½•ï¼šåˆ›å»ºæµæ°´çº¿è„šæœ¬`Jenkinsfile`â†’ æäº¤è‡³`Gitea`]</span>

![image-20251103014128159](wwwroot\DocImage\image-20251103014128159.png ':size=400')



!> <span style='color:red'>[ é…ç½®`Jenkins.Pipeline`é€šè¿‡`Gitea`æ‹‰å–å³å¯ ]</span>

![image-20251103014405258](wwwroot\DocImage\image-20251103014405258.png ':size=400')

<!-- tabs:end -->

