<br/>

>[!WARNING|style: flat|label: ç®€è¦è¯´æ˜ ]
>
>- åœ¨å¯åŠ¨å®¢æˆ·ç«¯çš„æ—¶å€™<span style='color:Blue'>[ é…ç½®å¤šä¸ªèŠ‚ç‚¹çš„åœ°å€ ]</span>å®¢æˆ·ç«¯ä¼šéšæœºæŒ‘é€‰ä¸€ä¸ªè¿›è¡Œè¿æ¥<span style='color:Red'> [ è¿æ¥æˆåŠŸåä¼šç»´æŒä¸€ä¸ª`WebSocket`é•¿è¿æ¥ ]</span>
>
>  âš  å¦‚æœè¿æ¥çš„èŠ‚ç‚¹å‘ç”Ÿæ•…éšœå¯¼è‡´è¿æ¥ä¸­æ–­[ å®¢æˆ·ç«¯ä¼šç»§ç»­éšæœºä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œè¿æ¥ ]
>
>  âš  <span style='color:red'>å¦‚æœæ‰€æœ‰èŠ‚ç‚¹éƒ½æ•…éšœ[ å®¢æˆ·ç«¯æ”¯æŒä»æœ¬åœ°ç¼“å­˜è¯»å–é…ç½® ]</span>
>
>  [<span style='color:#008B00'>[ğŸ‘“ NuGet - AgileConfig.Client ]</span>](https://github.com/kklldog/AgileConfig_Client/ ':target=_blank')
>
>
>---
>
>
>
>```csharp
>//å®¢æˆ·ç«¯
>public class ConfigClient : IConfigClient
>{
>
>      /// <summary>
>	   ///  - [ A ]è¯»å– appsettings.json => Path.Combine(AppContext.BaseDirectory, "appsettings.json")
>	   ///    {
>      ///
>	   ///         "AgileConfig": {
>	   ///              "name": "AppClient", //[ å®¢æˆ·ç«¯åç§° ]é…ç½®ä¸­å¿ƒæ§åˆ¶å°ç®¡ç†
>	   ///              "tag": "Tag1",       //å®¢æˆ·ç«¯æ ‡ç­¾
>	   ///          
>	   ///              "nodes": "http://localhost:5000,http://localhost:5001"   //[ å¿…é€‰ ]æ•°æ®èŠ‚ç‚¹( N )ä¸ªèŠ‚ç‚¹é€—å·åˆ†å‰²
>	   ///              "env": "DEV",        //è¯»å–ç¯å¢ƒ[ DEV : å¼€å‘ç¯å¢ƒ( é»˜è®¤ ) ][ TEST : æµ‹è¯•ç¯å¢ƒ ][ PROD : ç”Ÿäº§ç¯å¢ƒ ]
>	   ///              "appId": "åº”ç”¨ID",    //[ å¿…é€‰ ]
>	   ///              "secret": "åº”ç”¨å¯†é’¥", //[ å¿…é€‰ ]
>	   ///          
>	   ///               --ç¼“å­˜ç›¸å…³[ å¦‚æœæ‰€æœ‰èŠ‚ç‚¹éƒ½æ•…éšœ, å®¢æˆ·ç«¯æ”¯æŒä»æœ¬åœ°ç¼“å­˜è¯»å–é…ç½® ]
>	   ///               "cache": {
>	   ///		            "directory": "agile/config", //[ ç¼“å­˜æ–‡ä»¶è·¯å¾„ ]é…ç½®å­˜å‚¨åˆ°æœ¬åœ°
>	   ///		            "config_encrypt": true       //æ˜¯å¦å¯¹ç¼“å­˜æ–‡ä»¶[ å†…å®¹åŠ å¯† ]
>	   ///               },
>	   ///               "httpTimeout": "100"
>      ///          }
>      ///
>	   ///    }
>	   /// 
>	   /// </summary>
>      public ConfigClient(string json = "appsettings.json")
>      {
>
>            var localconfig = new ConfigurationBuilder()
>                             .AddJsonFile(json)
>                             .AddEnvironmentVariables()
>                             .AddCommandLine(Environment.GetCommandLineArgs())
>                             .Build();
>
>            var configSection = localconfig.GetSection("AgileConfig");
>            if (!configSection.Exists())
>                throw new Exception($"Can not find section:AgileConfig from IConfiguration instance .");
>
>            //æ„å»º ConfigClientOptions
>            ConfigClientOptions options = new ConfigClientOptions();
>            options.Name = configSection.GetSection("name").Value;
>            options.Tag = configSection.GetSection("tag").Value;
>
>            options.Nodes = configSection.GetSection("nodes").Value;
>            options.ENV = configSection.GetSection("env").Value;
>            options.AppId = configSection.GetSection("appId").Value; 
>            options.Secret = configSection.GetSection("secret").Value;
>
>            options.CacheDirectory = configSection.GetSection("cache:directory").Value; 
>            options.ConfigCacheEncrypt = configSection.GetValue<bool>("cache:config_encrypt");
>
>            this.SetOptions(options);
>
>      }
>      public ConfigClient(IConfiguration configuration, ILogger logger = null);
>
>      public ConfigClient(ConfigClientOptions options) => this.SetOptions(options);
>      public ConfigClient(string appId, string secret, string serverNodes, string env)
>      {
>            var options = new ConfigClientOptions();
>            options.AppId = appId;
>            options.Secret = secret;
>            options.Nodes = serverNodes;
>            options.ENV = env;
>            options.Logger = logger;
>
>            this.SetOptions(options);
>      }
>
>      /*... ä»£ç å¿½ç•¥ ...*/
>
>}
>
>
>```
>
>
>
><br/>

<!-- tabs:start -->

#### **AgileConfigSource**

```csharp
public class AgileConfigSource : IConfigurationSource
{
    
      protected IConfigClient ConfigClient { get; }
      public AgileConfigSource(IConfigClient client)
      {
           this.ConfigClient = client;
      }
      public IConfigurationProvider Build(IConfigurationBuilder builder) => new AgileConfigProvider(ConfigClient);
    
}


```



#### **AgileConfigProvider**

```csharp
public class AgileConfigProvider : ConfigurationProvider
{
    
	  private ConfigClient Client { get; }
	  public AgileConfigProvider(IConfigClient client)
	  {
		   this.Client = client as ConfigClient;
           //[ ç›‘æµ‹ ]é…ç½®å˜æ›´
		   this.Client.ConfigChanged += (arg) => { base.OnReload(); };
	  }

	  public override void Load()
	  {
	       //è¿æ¥æˆåŠŸåæ‹‰å–æ‰€æœ‰çš„é…ç½®
		   this.Client.ConnectAsync().GetAwaiter().GetResult() ;
		   base.Data = this.Client.Data;
	  }

}


```



#### **ConfigurationBuilderExtension**

```csharp
namespace Microsoft.AspNetCore.Hosting
    
public static class ConfigurationBuilderExtension
{

      public static IConfigurationBuilder AddAgileConfig(this IConfigurationBuilder builder,
           IConfigClient client, 
           Action<ConfigChangedArg> e = null)
      {
           //å˜æ›´å›è°ƒ
           if (e != null) client.ConfigChanged += e;
           return builder.Add(new AgileConfigSource(client));
      }

      public static IConfigurationBuilder AddAgileConfig(this IConfigurationBuilder builder, ConfigClientOptions options)
          => builder.AddAgileConfig(new ConfigClient(options));
      
      //è¯»å–: appsettings.json
      public static IConfigurationBuilder AddAgileConfig(this IConfigurationBuilder builder, Action<ConfigChangedArg> e = null)
          => builder.AddAgileConfig(new ConfigClient(), e);

}


```

#### **HostBuilderExtension**

```csharp
public static class HostBuilderExtension
{
    
      public static IHostBuilder UseAgileConfig(this IHostBuilder builder, string appsettingsFileName, Action<ConfigChangedArg> e = null)
	  {
          
		    builder.ConfigureAppConfiguration(delegate (HostBuilderContext _, IConfigurationBuilder cfb)
			{
					if (string.IsNullOrEmpty(appsettingsFileName))
					{
						 cfb.AddAgileConfig(e);
					}
					else
					{
						 cfb.AddAgileConfig(new ConfigClient(appsettingsFileName), e);
					}
			}).ConfigureServices(delegate (HostBuilderContext ctx, IServiceCollection services)
			{
					services.AddAgileConfig();
			});
			return builder;
          
	 }
     
     public static IHostBuilder UseAgileConfig(this IHostBuilder builder, IConfigClient client, Action<ConfigChangedArg> e = null);
     public static IHostBuilder UseAgileConfig(this IHostBuilder builder, Action<ConfigClientOptions> setOp);
    
     /*... ä»£ç å¿½ç•¥ ...*/
    
}


```



<!-- tabs:end -->

>- [`åº”ç”¨ - å…¬å…± P1`]
>
>```json
>{
>     "Q1": "Q1",
>     "Q2": "Q2",
>     "Q3": "Q31"
>}
>
>
>```
>
>- [`åº”ç”¨ - PM2.WEB A1 => ç»§æ‰¿ P1`]
>
>```json
>{
>     
>     "Name": "å¼ ä¸‰",
>     "Age": "20",
>     
>     "ContactInfo": { "Email": "xxxx@qq.com", "PhontNo": "13810017000" },
>     "KeMus": [
>          { "Name": "æ•°å­¦", "Proc": "80" },
>          { "Name": "è¯­æ–‡", "Proc": "80" }
>     ]
>   
>}
>
>
>```
>
>```csharp
>IConfigurationRoot root = new ConfigurationBuilder()
>										.AddAgileConfig(new ConfigClientOptions
>										{
>											 Name = "TestApp",
>
>											 Nodes = "http://192.168.0.7:5000",
>											 ENV = "DEV",
>											 AppId = "A1",
>											 Secret = "888888",
>
>											 CacheDirectory = "agile/config",
>											 ConfigCacheEncrypt = false
>										}).Build();
>
>
>foreach ((string key, string value) in root.AsEnumerable())
>{
>
>	  /// <summary>
>	  /// - åº”ç”¨( å…¬å…± P1 )
>	  ///   Key: Q1, Value: Q1
>	  ///   Key: Q2, Value: Q2
>	  ///   Key: Q3, Value: Q3
>	  ///   
>	  /// - åº”ç”¨( PM2.WEB A1 )
>	  ///   Key: Name, Value: å¼ ä¸‰
>	  ///   Key: Age, Value: 20
>	  ///   
>	  ///   Key: ContactInfo, Value:
>	  ///   Key: ContactInfo: PhontNo, Value: 13810017000
>	  ///   Key: ContactInfo: Email, Value: xxxx @qq.com
>	  ///   
>	  ///   Key: KeMus, Value:
>	  ///   Key: KeMus: 0, Value:
>	  ///   Key: KeMus: 0:Name, Value: æ•°å­¦
>	  ///   Key: KeMus: 0:Proc, Value: 80
>      ///
>	  ///   Key: KeMus: 1, Value:
>	  ///   Key: KeMus: 1: Name, Value: è¯­æ–‡
>	  ///   Key: KeMus: 1: Proc, Value: 80
>	  /// </summary>
>	  Console.WriteLine($"Key: {key}, Value: {value}");
>
>}
>
>
>```
>
><br/>



