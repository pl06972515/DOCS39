<br/>

>[!WARNING|style: flat|label: 简要说明 ]
>
>- 其原始数据源为`IConfiguration`<span style='color:red'>[ 根据其现有的`IConfiguration`构建新的`IConfiguration`]</span>
>
> <br/>



<!-- tabs:start -->

#### **ChainedConfigurationSource**

```csharp
public class ChainedConfigurationSource : IConfigurationSource
{
       
      public IConfiguration? Configuration { get; set; }

      // [ 是否由当前 ] ChainedConfigurationSource 控制回收
      public bool ShouldDisposeConfiguration { get; set; }

      public IConfigurationProvider Build(IConfigurationBuilder builder)
          => new ChainedConfigurationProvider(this);
    
}


```







#### **ChainedConfigurationProvider**

```csharp
public class ChainedConfigurationProvider : IConfigurationProvider, IDisposable
{
    
      private readonly bool _shouldDisposeConfig;
      
      private readonly IConfiguration _config;
      public IConfiguration Configuration => _config;
      
      public ChainedConfigurationProvider(ChainedConfigurationSource source)
      {
           this._config = source.Configuration;
           this._shouldDisposeConfig = source.ShouldDisposeConfiguration;
      }

      public void Set(string key, string? value) => this._config[key] = value;
      public bool TryGet(string key, out string? value)
      {
           this.value = this._config[key];
           return !string.IsNullOrEmpty(value);
      }

      public IChangeToken GetReloadToken() => this._config.GetReloadToken();
      public void Load() { }

      public IEnumerable<string> GetChildKeys(
             IEnumerable<string> earlierKeys,
             string? parentPath);

      public void Dispose()
      {
            if (_shouldDisposeConfig)
            {
                 (_config as IDisposable)?.Dispose();
            }
      }
    
}


```



#### **ChainedBuilderExtensions**

```csharp
public static class ChainedBuilderExtensions
{
    
      public static IConfigurationBuilder AddConfiguration(this IConfigurationBuilder configurationBuilder, IConfiguration config)
            => AddConfiguration(configurationBuilder, config, shouldDisposeConfiguration: false);

      public static IConfigurationBuilder AddConfiguration(this IConfigurationBuilder configurationBuilder, 
                                                           IConfiguration config, 
                                                           bool shouldDisposeConfiguration)
      {
            configurationBuilder.Add(new ChainedConfigurationSource
            {
                  Configuration = config,
                  ShouldDisposeConfiguration = shouldDisposeConfiguration,
            });
            return configurationBuilder;
      }
    
}


```

<!-- tabs:end -->



>```csharp
>var source = new Dictionary<string, string>
>{
>	  ["A:B:C"] = "ABC"
>};
>IConfigurationRoot root = new ConfigurationBuilder()
>							 .AddInMemoryCollection(source)
>							 .Build();
>
>//根据 IConfiguration [ 构建新的配置信息 ]
>IConfigurationRoot newRoot = new ConfigurationBuilder()
>							 .AddConfiguration(root.GetSection("A"))
>							 .Build();
>
>IConfigurationSection section = newRoot.GetSection("B:C");
>Console.WriteLine(section.Value);
>
>
>```
>
>     





