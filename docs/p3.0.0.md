<br/>

>[!WARNING|style: flat|label:  ç®€è¦è¯´æ˜ ]
>
>- <span style='color:Blue'>[ ç‰©ç†æ–‡ä»¶ ] </span>æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„åŸå§‹é…ç½®æ•°æ®çš„è½½ä½“
>
>   [<span style='color:#008B00'>[ğŸ‘“ NuGet - Microsoft.Extensions.Configuration.FileExtensions ]</span>](https://www.nuget.org/packages/Microsoft.Extensions.Configuration.FileExtensions/ ':target=_blank')
>
>  <br/>
>

<!-- tabs:start -->

#### **FileConfigurationSource**

```csharp
public abstract class FileConfigurationSource : IConfigurationSource
{

       #region åŸºç¡€ä¿¡æ¯
           
       public bool Optional { get; set; }           // [ æ˜¯å¦å¯é€‰ ]
       public string Path { get; set; }             // [ æ–‡ä»¶è·¯å¾„ ] ç›¸å¯¹è·¯å¾„: FileProvider.GetFileInfo(Path)
       public IFileProvider FileProvider { get; set; }
    
       public bool ReloadOnChange { get; set; }     // æ˜¯å¦å¼€å¯: æ–‡ä»¶ç›‘æ§( å€ŸåŠ©: IFileProvider.Watch(string filter) )
       public int ReloadDelay { get; set; } = 250;  // [ å˜æ›´é€šçŸ¥ ] å»¶è¿Ÿé‡è½½æ–‡ä»¶(æ¯«ç§’)

       #endregion
       
       # [ å¸®åŠ©æ–¹æ³• ] é»˜è®¤æ–‡ä»¶æ ¹ç›®å½• new PhysicalFileProvider(AppContext.BaseDirectory ?? string.Empty)
       public void EnsureDefaults(IConfigurationBuilder builder)
           => this.FileProvider = this.FileProvider ?? builder.GetFileProvider();
       
       public abstract IConfigurationProvider Build(IConfigurationBuilder builder);
       
       /*... ä»£ç å¿½ç•¥ ...*/
        
}


```



#### **[ â˜¢ è·¯å¾„æ‰©å±• ]FileConfigurationExtensions**

```csharp
public static class FileConfigurationExtensions
{
    
       private static string FileProviderKey = "FileProvider";
    
       // [ è®¾ç½® ] IFileProvider
       public static IConfigurationBuilder SetBasePath(this IConfigurationBuilder builder, string basePath)
       {
           
             builder.SetFileProvider(new PhysicalFileProvider(basePath));
             builder.Properties[FileProviderKey] = fileProvider;
             return builder;
           
       }
       
       public static IFileProvider GetFileProvider(this IConfigurationBuilder builder)
       {
           
            if (builder.Properties.TryGetValue(FileProviderKey, out object? provider))
                return (IFileProvider)provider;
            // [ AppContext.BaseDirectory ]
            return new PhysicalFileProvider(AppContext.BaseDirectory ?? string.Empty);
            
       }
       
}


```





#### **FileConfigurationProvider**

```csharp
public abstract class FileConfigurationProvider : ConfigurationProvider, IDisposable
{

	  private readonly IDisposable? _changeTokenRegistration;

	  public FileConfigurationSource Source { get; }
	  public FileConfigurationProvider(FileConfigurationSource source)
	  {
            
		    this.Source = source;
		    # [ æ˜¯å¦å¼€å¯: æ–‡ä»¶ç›‘æ§ ]
		    if (this.Source.ReloadOnChange && this.Source.FileProvider != null)
		    {
			      this._changeTokenRegistration = ChangeToken.OnChange(
				      () => this.Source.FileProvider.Watch(this.Source.Path!),
				      () =>
				      {
                           // å»¶è¿Ÿè¯»å–
						   Thread.Sleep(Source.ReloadDelay); 
						   this.Load();
				      });
		    }

	 }

     # [ ä¸­é—´å­—å…¸è½¬æ¢ ] Stream -> IDictionary<string, string>
	 public override void Load()
	 {

		  IFileInfo? fileInfo = this.Source.FileProvider?.GetFileInfo(this.Source.Path ?? string.Empty);
		  
          // [ æƒ…å†µ A ] å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨
		  if (fileInfo == null || !fileInfo.Exists)
		  {
			   if (this.Source.Optional)
				   this.Data = new Dictionary<string, string?>(StringComparer.OrdinalIgnoreCase);
			   else
				   throw new Exception("æ–‡ä»¶ä¸å­˜åœ¨!");
		  }
		  else
		  {
			   
			   try
			   {
					using Stream stream = new FileStream(
						   fileInfo.PhysicalPath,
						   FileMode.Open,
						   FileAccess.Read,
						   FileShare.ReadWrite,
						   1,
						   FileOptions.Asynchronous | FileOptions.SequentialScan);
					this.Load(stream);

			   }
			   catch (Exception ex)
			   {
					throw new Exception("æ–‡ä»¶å†…éƒ¨å¼‚å¸¸!");
			   }

		  }

		  base.OnReload();

	 }

	 // [ æ¨¡æ¿æ–¹æ³• ] æ ¹æ® Stream -> è½¬æ¢é…ç½®å­—å…¸
	 public abstract void Load(Stream stream);
	 public void Dispose() => this._changeTokenRegistration?.Dispose();

}


```



<!-- tabs:end -->

