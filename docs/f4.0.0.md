<br/>



>[!WARNING|style: flat|label:  ç®€è¦è¯´æ˜ ]
>
>- æ­¤åŠŸèƒ½ä¸»è¦ç”¨äº <span style='color:red'>[ å®æ—¶æŸ¥çœ‹å½“å‰é…ç½®ä¿¡æ¯ ]</span> [<span style='color:#008B00'>[ğŸ‘“ Q1 ]</span>](https://mp.weixin.qq.com/s?__biz=MzAwNTMxMzg1MA==&mid=2654099781&idx=2&sn=ca41790e0fffbad0b1846ac86ca843b1&chksm=80d87d10b7aff4063f583ba83d3e7cb9293247f98935c6dde13a713577de73529b1b33c9c6b1&mpshare=1&scene=23&srcid=0701uxcPzWLO8YYk7qgee4O3&sharer_shareinfo=0296e447293b82fedbb731f783f2c832&sharer_shareinfo_first=0296e447293b82fedbb731f783f2c832#rd ':target=_blank')
>
> ```csharp
>// [ é…ç½®é¡¹ ]
> public sealed class ConfigItemModel
>{
>    
>      public string Key { get; set; } = default!;
>      public string? Value { get; set; }
>
>      // [ æ˜¯å¦ç”Ÿæ•ˆ ] å› åæ¥è€…å±…ä¸Š
>      public bool Active { get; set; }
>    
>}
>
>public sealed class ConfigModel
>{
>      public string Provider { get; set; } = default!;
>      public IEnumerable<ConfigItemModel> Items { get; set; } = [];
>}
>
>
>```
>
><br/>

<!-- tabs:start -->

#### **æ ‡å‡†å®ç°**

```csharp
static IEnumerable<ConfigModel> ConfigRenderer(IConfigurationRoot configurationRoot)
{

     Dictionary<string, bool>? allKeys = configurationRoot.AsEnumerable()
                 .ToDictionary(x => x.Key, _ => false);

     var providers = configurationRoot.Providers.Where(x => x is not ChainedConfigurationProvider).ToArray();
     for (var i = providers.Length - 1; i >= 0; i--)
     {

          IConfigurationProvider? provider = providers[i];
          IEnumerable<ConfigItemModel> configItemModels = _GetConfig(provider, allKeys);
          if (configItemModels.Any())
          {
               yield return new ConfigModel
               {
                    Provider = provider.ToString() ?? provider.GetType().Name,
                    Items = configItemModels
               };
          }

     }

     IEnumerable<ConfigItemModel> _GetConfig(IConfigurationProvider provider, Dictionary<string, bool> allKeys)
     {

          var keys = allKeys.Keys;
          foreach (string key in keys)
          {
               if (provider.TryGet(key, out var v))
               {
                    bool Active = allKeys[key];
                    if (Active == false)
                         allKeys[key] = true;

                    yield return new ConfigItemModel
                    {
                         Key = key,
                         Value = v,
                         Active = !Active
                    };
               }
          }

     }

}


```

>```csharp
>var source1 = new Dictionary<string, string>
>{
>      ["ContactInfo:Email"] = "13810000000@qq.com",
>      ["ContactInfo:PhontNo"] = "20"
>
>};
>var source2 = new Dictionary<string, string>
>{
>
>      ["Name"] = "å¼ ä¸‰",
>      ["Age"] = "20",
>
>      ["ContactInfo:Email"] = "13810000000@qq.com",
>      ["ContactInfo:PhontNo"] = "20"
>
>};
>var source3 = new Dictionary<string, string>
>{
>};
>IConfigurationRoot root = new ConfigurationBuilder()
>                              .AddInMemoryCollection(source1)
>                              .AddInMemoryCollection(source2)
>                              .AddInMemoryCollection(source3)
>                              .Build();
>
>/// <summary>
>/// MemoryConfigurationProvider
>/// - ContactInfo: PhontNo =  20 - True
>/// - ContactInfo: Email = 13810000000@qq.com - True
>///
>/// MemoryConfigurationProvider
>/// - Name =  å¼ ä¸‰ - True
>/// - Age =  20 - True
>/// - ContactInfo:PhontNo = 20 - False
>/// - ContactInfo: Email = 13810000000@qq.com - False
>///
>/// </summary>
>var configModels = ConfigRenderer(root);
>foreach (ConfigModel item in configModels)
>{
>    
>      Console.WriteLine(item.Provider);
>      foreach (var item1 in item.Items)
>      {
>           Console.WriteLine($"{ item1.Key } = {item1.Value} - {item1.Active}");
>      }
>    
>}
>
>
>```
>
>
>
>



#### **è·¯ç”±é›†æˆ**

```csharp
public sealed class ConfigRendererMiddleware
{

     private readonly RequestDelegate _next;
     private readonly IConfiguration _configuration;

     public ConfigRendererMiddleware(RequestDelegate next,
                                     IWebHostEnvironment hostingEnv,
                                     IConfiguration configuration)
     {

          this._next = next;
          this._configuration = configuration;
     }

     public Task Invoke(HttpContext context)
     {

          if (this._configuration is IConfigurationRoot configurationRoot)
          {
               
               IEnumerable<ConfigModel> configModels = ConfigRenderer(configurationRoot);
               return context.Response.WriteAsJsonAsync(configModels,
                                                        options: new JsonSerializerOptions { WriteIndented = true });

          }
          return _next(context);

     }

}

public static class StaticFileExtensions
{

     public static IEndpointRouteBuilder MapGet_UseConfigRenderer(this IEndpointRouteBuilder endpoints, string pattern = "/config")
     {

          //[ ç‹¬ç«‹ ]å¤„ç†ç®¡é“
          var newAppBuilder = endpoints.CreateApplicationBuilder();
          newAppBuilder.UseMiddleware<ConfigRendererMiddleware>();
          var tangent = newAppBuilder.Build();

          endpoints.MapGet(pattern, tangent);
          return endpoints;

     }

}

```

>```csharp
>WebApplicationBuilder? builder = WebApplication.CreateBuilder(args);
>var app = builder.Build();
>
>app.MapGet("/", (HttpContext context) =>
>{
>     
>});
>
>app.MapGet_UseConfigRenderer();
>
>
>```
>
>
>
>



<!-- tabs:end -->



